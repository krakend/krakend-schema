on: [push]
name: Validate JSON Schema
permissions:
  contents: write
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: intelligence-ai/jsonschema@v1.1.2
      - name: Ensure JSON Schemas are formatted
        run: jsonschema fmt --ignore test --check --verbose
      - name: Lint JSON Schemas
        run: jsonschema lint --ignore test --verbose
      - name: Ensure JSON Schemas are valid with respect to their metaschemas
        run: jsonschema metaschema --ignore test --verbose
      - name: Run JSON Schema unit tests
        run: jsonschema test ./test/v2.7 --resolve v2.7
      - name: Create a unified bundle
        run: jsonschema bundle v2.7/_root.json --resolve v2.7 --without-id > v2.7/krakend.json
      - name: Format bundle file
        run: jsonschema fmt v2.7/krakend.json
      - uses: EndBug/add-and-commit@v9
        with:
          # The arguments for the `git add` command (see the paragraph below for more info)
          # Default: '.'
          add: 'v2.7/krakend.json'
